# 字幕图片生成工具 PRD

## 一、产品概述
- 这是一个网页端工具，用于在用户上传的图片底部叠加多行字幕，并生成可下载的成品图片。
- 每一行字幕都有一条跨整张图片宽度的相同背景条，所有行的背景条在底部依次堆叠，形成明显的“切割感”。
- 工具提供实时预览、参数可调（字幕高度、字体大小、颜色、字体样式、粗细）以及生成与保存能力。

## 二、目标与非目标
- 目标：快速为图片添加底部多行字幕，呈现统一切割风格，并可导出为常用格式（PNG）。
- 非目标：不做复杂图像编辑（滤镜、贴纸、裁剪）、不做社交分享页面。

## 三、用户与场景
- 用户：需要为海报、封面、宣传图添加底部文字说明的运营、设计或内容创作者。
- 场景：将多句文案按行输出到底部，突出分层阅读与切割视觉。

## 四、关键指标（KPI）
- 单次生成耗时 ≤ 200ms（1080p 图片，现代桌面浏览器）。
- 预览交互延迟 ≤ 100ms（参数变化引起的重新渲染）。
- 导出图片与预览一致性 100%。

## 五、信息架构与页面结构
- 左侧控制面板
  - 上传图片
  - 字幕设置：字幕高度、字体大小、字体颜色、背景条颜色（弹窗含透明度）、字体样式、字体粗细
  - 字幕内容：多行文本输入框
  - 操作按钮：生成字幕图片、保存字幕图片
- 右侧预览面板
  - 预览区域（适配容器，展示渲染结果）
  - Toast 提示区（生成成功、错误提示）

## 六、功能需求
### 1. 上传图片
- 支持点击按钮选择本地图片（PNG、JPG、JPEG、WebP）。
- 成功后在面板显示文件名；预览区域展示原图。
- 文件大小上限与类型校验：超过上限或类型不符需提示。

### 2. 字幕设置
- 字幕高度（px）：控制底部为字幕预留的总垂直空间，用于堆叠各行背景条。
- 字体大小（px）：影响每行文字排版；不自动换字号，超出时给出溢出提示。
- 字体颜色：统一控制所有行文字的填充色；颜色预览直接显示在选项框背景中。
- 背景条颜色（弹窗）：统一控制所有行背景条的颜色；点击选项框弹出面板，面板内包含颜色选择与透明度滑块。透明度滑块上方有“透明度”文字标识，默认值为 20%。选项框本体使用棋盘底纹+颜色叠加展示当前透明度效果。
- 字体样式：系统默认 + 常规备选（如 `serif/sans-serif`）。
- 字体粗细：正常/加粗等枚举值。

### 3. 字幕内容
- 多行输入框，按换行符 `\n` 分割为行。
- 去除每行首尾空白；允许空行但渲染为空背景条（无文字）。

### 4. 预览
- 在用户未点击“生成字幕图片”前，仅展示原始图片，不叠加字幕或背景条。
- 参数变化（高度、字号、颜色、样式、文本内容）实时刷新原图预览，并提示“参数已变更，请点击生成”。
- 预览等比缩放显示，保证与导出像素渲染一致（画布内部按原图像素渲染）。

### 5. 生成与保存
- 生成按钮：在页面内合成字幕（统一背景条 + 文本）并更新预览，不自动下载。
- 保存字幕图片按钮：将已生成的字幕图片导出并下载；若尚未生成则提示“请先生成字幕图片”。
- 生成成功弹出绿色 Toast：“字幕图片生成成功！”

### 6. 错误与提示
- 无图片时点击生成：提示“请先上传图片”。
- 文本为空时点击生成：提示“请输入字幕内容”，并阻止生成。
- 字幕高度为 0 或负值：阻止渲染并提示“字幕高度需为正数”。

## 七、字幕渲染规范（核心）
### 1. 背景条切割效果
- 每一行文本对应一条“背景条”，所有背景条：
  - 颜色、透明度、圆角（若有）、边框样式一致。
  - 横向跨整张图片宽度（宽度 = 图片宽度）。
  - 在图片底部按行数依次自下向上堆叠，形成清晰分层的切割感。
- 背景条高度计算：
  - 若有 N 行文本，`单条背景高度 = floor(字幕高度 / N)`。
  - 行间距：默认 0；若需间隔，可在条内留内边距实现（推荐统一无间距，增强切割感）。

### 2. 文本排版
- 水平对齐：居中（可扩展左/右对齐）。
- 垂直对齐：文字在对应背景条垂直居中；条内留 `paddingTop/Bottom = max(4px, round(fontSize*0.2))`。
- 行内换行：不进行自动断词；用户输入一行即视为一个背景条。
- 超出处理：若 `fontSize + 内边距 > 单条背景高度`，显示红色提示“字体过大，请增大字幕高度或减小字号”，并仍按设定渲染（允许文字溢出背景条上边缘）。

### 3. 文本描边
- 本期不提供文字描边配置，默认不绘制描边。

### 4. 颜色与透明度
- 背景条颜色与透明度统一应用到所有行，确保一致切割风格。
- 文本颜色统一应用到所有行文字。
- 颜色控件本身展示颜色预览（背景条颜色带透明度棋盘预览）。

### 5. 导出一致性
- 预览画布与导出画布尺寸与算法完全一致；导出结果与预览像素级一致。

## 八、参数范围与默认值
- 字幕高度：默认 100px；范围 [0, 0.5×图片高度]。
- 字体大小：默认 80px；范围 [12px, 0.8×单条背景高度]（以提示为准）。
- 字体颜色：默认白色 `#FFFFFF`。
- 轮廓颜色：默认黑色 `#000000`。
- 字体样式：默认系统字体。
- 字体粗细：默认“正常”。

## 九、技术方案（前端）
- 渲染：HTML5 Canvas 2D（或 OffscreenCanvas）；图片按原尺寸绘制背景+文字。
- 文本对齐：`textAlign = 'center'`；垂直居中通过计算背景条中线 + 字体基线修正。
- 性能：参数变更仅重绘一次；图片资源缓存；防抖 50ms。
- 文件导出：`canvas.toBlob` → 触发下载，文件名沿用上传名加后缀 `-captioned`。

## 十、兼容性与适配
- 浏览器：Chrome 95+、Edge 95+、Safari 14+、Firefox 90+。
- 响应式：左侧面板与右侧预览在窄屏垂直排列；预览最大宽度不超过容器。

## 十一、无障碍与易用性
- 输入控件均有标签；按钮有 ARIA 属性。
- 颜色选择提供对比度提示；键盘可操作（Tab 顺序合理）。

## 十二、埋点与日志（可选）
- 事件：上传成功/失败、生成点击、导出成功/失败、参数变更。
- 性能：生成耗时、预览重绘耗时。

## 十三、验收标准
- 预览与导出完全一致。
- 多行文本每行都有宽度一致、样式一致的底部背景条，整体呈明显切割分层效果。
- 在图像底部区域按行数堆叠，条与条之间无颜色差异与样式差异。
- 常见边界（空文本、超大字体、极小高度）有合理提示与处理。

## 十四、后续拓展（不在本期）
- 可配置背景条透明度/圆角/描边宽度。
- 行级样式独立配置、图标或表情支持。
- 自定义对齐方式与行间距。
